<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">

<properties>
  <entry key="default">
    <![CDATA[
  SELECT
      /* $reportUser.userName */
        /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
    max(dp.name) as provider, f.data_provider_id as providerId, sum(f.num_requests) as providerRequests, sum(t.bids_requested) as overallBidRequests,
    sum(f.num_bids) as bidReceived, sum(f.num_wins) as wins
  FROM
      fact_traffic_bidder_data f
      CROSS JOIN (SELECT
          sum(f.bid_requests) as bids_requested
          FROM fact_exchange_bidders f
              WHERE f.start >= :start
                  AND f.start < :stop
                    #if ($request.buyer) AND f.bidder_id in (SELECT id FROM dim_bidder WHERE company_id = :buyer) #end) as t
        INNER JOIN dim_data_provider dp ON dp.id = f.data_provider_id
  WHERE
      f.start >= :start
      AND f.start < :stop
      #if ($request.buyer) AND f.bidder_id in (SELECT id FROM dim_bidder WHERE company_id = :buyer) #end
  GROUP BY f.data_provider_id
  ]]>
  </entry>
  <entry key="dim=bidder">
    <![CDATA[
  SELECT
      /* $reportUser.userName */
        /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
    max(dp.name) as provider, max(dp.id) as providerId, sum(f.num_requests) as providerRequests, sum(t.bids_requested) as overallBidRequests,
    sum(f.num_bids) as bidReceived, sum(f.num_wins) as wins,
    db.name as bidder,db.id as bidderId
  FROM
      fact_traffic_bidder_data f
      CROSS JOIN (SELECT
          sum(f.bid_requests) as bids_requested
          FROM fact_exchange_bidders f
              WHERE f.start >= :start
                  AND f.start < :stop
                    #if ($request.buyer) AND f.bidder_id in (SELECT id FROM dim_bidder WHERE company_id = :buyer) #end) as t
        INNER JOIN dim_data_provider dp ON dp.id = f.data_provider_id
        INNER JOIN dim_bidder db ON db.id = f.bidder_id
  WHERE
      f.start >= :start
      AND f.start < :stop
      AND f.data_provider_id = :dataprovider
      #if ($request.buyer) AND f.bidder_id in (SELECT id FROM dim_bidder WHERE company_id = :buyer) #end
  GROUP BY db.id, db.name
  ]]>
  </entry>
</properties>
