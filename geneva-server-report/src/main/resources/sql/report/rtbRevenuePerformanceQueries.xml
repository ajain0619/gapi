<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">

<properties>
  <entry key="default">
    <![CDATA[
  SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
        SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue
  FROM
        fact_exchange_wins f
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
  ]]>
  </entry>
  <entry key="dim=site">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      f.site_id as siteId, d.name as site
  FROM
        fact_exchange_wins f
        INNER JOIN dim_site d ON d.id = f.site_id
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.position) AND f.zone = :position #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY f.site_id, d.name
  ]]>
  </entry>
  <entry key="dim=position">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      f.zone as position, d.memo AS positionMemo
  FROM
        fact_exchange_wins f
        LEFT JOIN dim_position AS d ON f.site_id = d.site_id and f.zone = d.name
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY f.zone, d.memo
  ]]>
  </entry>
  <entry key="dim=tag">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      f.tag_id as adTagId, d.name as adTag
  FROM
        fact_exchange_wins f
        INNER JOIN dim_tag d ON d.id = f.tag_id
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.position) AND f.zone = :position #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY f.tag_id, d.name
  ]]>
  </entry>
  <entry key="dim=country">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      f.country as country
  FROM
        fact_exchange_wins f
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.position) AND f.zone = :position #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY f.country
  ]]>
  </entry>
  <entry key="dim=bidder">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      f.bidder_id as bidderId, d.name as bidder
  FROM
        fact_exchange_wins f
        INNER JOIN dim_bidder d ON d.id = f.bidder_id
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.position) AND f.zone = :position #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY f.bidder_id, d.name
  ]]>
  </entry>
  <entry key="dim=buyer">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      d2.id as buyerId, d2.name as buyer
  FROM
        fact_exchange_wins f
        INNER JOIN dim_bidder d1 ON d1.id = f.bidder_id
        INNER JOIN dim_company d2 ON d2.id = d1.company_id
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.position) AND f.zone = :position #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY d2.id, d2.name
  ]]>
  </entry>
  <entry key="dim=adomain">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      f.advertiser as rtbAdvertiserDomain
  FROM
        fact_exchange_wins f
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.position) AND f.zone = :position #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY f.advertiser
  ]]>
  </entry>
  <entry key="dim=seat">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      f.seat_id as seat
  FROM
        fact_exchange_wins f
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.position) AND f.zone = :position #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY f.seat_id
  ]]>
  </entry>
  <entry key="dim=deal">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      f.deal_id as dealId
  FROM
        fact_exchange_wins f
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.position) AND f.zone = :position #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY f.deal_id
  ]]>
  </entry>
  <entry key="dim=month">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      date_trunc('month', f.start) as interval
  FROM
        fact_exchange_wins f
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.position) AND f.zone = :position #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY date_trunc('month', f.start)
  ]]>
  </entry>
  <entry key="dim=week">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      greatest(timestamp_trunc(f.start, 'dy'),  to_date(:start, 'YYYY-MM-DD')) AS interval
  FROM
        fact_exchange_wins f
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.position) AND f.zone = :position #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY timestamp_trunc(f.start, 'dy')
  ]]>
  </entry>
  <entry key="dim=day">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      date_trunc('day', f.start) as interval
  FROM
        fact_exchange_wins f
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.position) AND f.zone = :position #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY date_trunc('day', f.start)
  ]]>
  </entry>
  <entry key="dim=hour">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      date_part('hour', f.start) as interval
  FROM
        fact_exchange_wins f
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.position) AND f.zone = :position #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY date_part('hour', f.start)
  ]]>
  </entry>
  <entry key="dim=s2sHbPartner">
    <![CDATA[
    SELECT
      /* $reportUser.userName */ /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
      SUM(f.ads_served) AS adServed, SUM(f.ads_delivered) AS adDelivered, SUM(f.revenue) AS totalRevenue, SUM(f.revenue_net)  as mmRevenue,
      (CASE WHEN f.hb_partner_pid IS NULL THEN -999 ELSE f.hb_partner_pid END) AS s2sHbPartnerPid,
        IFNULL (p.id, 'Direct') AS s2sHbPartner, IFNULL(p.name, 'Direct') AS s2sHbPartnerName
  FROM
        fact_exchange_wins f
        LEFT JOIN dim_hb_partner p ON p.pid = f.hb_partner_pid
    WHERE
        f.start >= :start
        AND f.start < :stop

        #if ($request.site) AND f.site_id = :site #end
        #if ($request.position) AND f.zone = :position #end
        #if ($request.tag) AND f.tag_id = :tag #end
        #if ($request.country) AND f.country = :country #end
        #if ($request.bidder) AND f.bidder_id = :bidder #end
        #if ($request.buyer) AND f.bidder_id IN (SELECT id FROM dim_bidder d WHERE d.company_id = :buyer) #end
        #if ($request.adomain) AND f.advertiser = :adomain #end
        #if ($request.seat) AND f.seat_id = :seat #end
        #if ($request.deal) AND f.deal_id = :deal #end
        #if ($request.siteIds && !$request.siteIds.isEmpty())
             AND f.site_id IN (:siteIds) ## Sites restriction is present
        #elseif ($request.siteIds && $request.siteIds.isEmpty())
             AND 1 = 0 ## No sites are allowed
        #end
        #if(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner==-999)
            AND (f.hb_partner_pid IS NULL OR f.hb_partner_pid=-999)
        #elseif(!$StringUtils.isEmpty($s2sHbPartner) && $s2sHbPartner!=-999)
            AND f.hb_partner_pid = :s2sHbPartner
        #end
    GROUP BY f.hb_partner_pid, p.id, p.name
  ]]>
  </entry>
</properties>
