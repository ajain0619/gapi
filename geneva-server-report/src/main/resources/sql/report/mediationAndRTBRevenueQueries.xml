<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">

<properties>
  <entry key="default">
    <![CDATA[
    SELECT
        /* $reportUser.userName */
        /*+label($!reportMetadata.environment$$!reportMetadata.reportType$$!reportMetadata.reportName$$!dim)*/
        t.adnet_id as customerId,
        d.name as customerName,
        'Ad Source' as customerType,
        sum(t.revenue) as totalRevenue,
        sum(t.revenue_gross) as grossRevenue,
        sum(t.revenue_net) as netRevenue,
        (sum(t.revenue_net)*100)/sum(t.revenue_gross) as grossMargin,
        1 sortby
   FROM fact_revenue_adnet_vw_daily t
    INNER JOIN dim_adnet d ON t.adnet_id = d.id AND d.id IS NOT NULL
    WHERE
        t.revenue_gross > 0 AND t.tag_owner=1 AND
        t.start >= :start AND t.start < :stop
    GROUP BY t.adnet_id, d.name
    UNION ALL
    SELECT
        t.site_id as customerId,
        s.name as customerName,
        'Seller' as customerType,
        sum(t.revenue) as totalRevenue,
        sum(t.revenue_gross) as grossRevenue,
        sum(t.revenue_net) as netRevenue,
        (sum(t.revenue_net)*100)/sum(t.revenue_gross) as grossMargin,
      2 sortby
   FROM fact_revenue_adnet_vw_daily t
    INNER JOIN dim_tag d ON d.id = t.tag_id
    INNER JOIN dim_site s ON s.id = d.site_id AND d.id IS NOT NULL
    WHERE
        t.revenue_gross > 0 AND t.tag_owner=1 AND
        t.start >= :start AND t.start < :stop
    GROUP BY t.site_id, s.name
    ORDER BY sortby ASC, customerName ASC
  ]]>
  </entry>
</properties>
