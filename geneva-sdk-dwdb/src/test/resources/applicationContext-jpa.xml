<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd

    http://www.springframework.org/schema/tx  http://www.springframework.org/schema/tx/spring-tx-3.0.xsd

    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd">

  <!-- Enable JPA Support -->
  <bean class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor"/>

  <!-- Define EntityManagerFactory and Datasource -->
  <!-- By default LocalContainerEntityManagerFactoryBean supports standard JPA
       by searching persistence.xml file. By default it tries to load the
       persistence.xml file from classpath:META-INF/persistence.xml.

       persistence.xml file is also used to enable 2nd level caching for
       Hibernate.

       Configure
       org.springframework.orm.jpa.persistenceunit.DefaultPersistenceUnitManager
       if you want to customize this.
  -->

  <util:map id="jpaPropertyMap" map-class="java.util.TreeMap">
    <entry key="javax.persistence.validation.factory" value-ref="validator"/>
  </util:map>

  <bean id="jpaAdapter"
        class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"
        p:showSql="false"
        p:generateDdl="false"/>

  <bean id="jpaDialect"
        class="org.springframework.orm.jpa.vendor.HibernateJpaDialect"/>

  <!-- TODO remove ApplicationEntityManager hard code -->
  <bean id="entityManagerFactory"
        class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"
        p:dataSource-ref="coreDS"
        p:persistenceUnitName="ApplicationEntityManager"
        p:jpaDialect-ref="jpaDialect"
        p:jpaPropertyMap-ref="jpaPropertyMap"
        p:jpaVendorAdapter-ref="jpaAdapter">
  </bean>

  <!-- Define Transaction Manager -->
  <bean id="transactionManager"
        class="org.springframework.orm.jpa.JpaTransactionManager"
        p:nestedTransactionAllowed="true"
        p:entityManagerFactory-ref="entityManagerFactory"/>

  <!-- enable the configuration of transactional behavior based on annotations -->
  <tx:annotation-driven transaction-manager="transactionManager"/>

  <bean id="validator"
        class="org.springframework.validation.beanvalidation.LocalValidatorFactoryBean"/>
</beans>
